<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Dodawanie Aplikacji</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .test-form {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test - Dodawanie Aplikacji</h1>
        <p>Test funkcjonalno≈õci dodawania aplikacji o pracƒô po naprawie b≈Çƒôd√≥w Firebase.</p>
        
        <div id="authStatus" class="status info">
            ‚è≥ Sprawdzanie uwierzytelnienia...
        </div>
        
        <div id="firebaseStatus" class="status info">
            ‚è≥ Inicjalizowanie Firebase...
        </div>
        
        <div class="test-form" id="testForm" style="display: none;">
            <h3>Formularz testowy</h3>
            <form id="addTestApplication">
                <label for="stanowisko">Stanowisko (TEST):</label>
                <input type="text" id="stanowisko" value="Frontend Developer TEST" required>
                
                <label for="firma">Firma (TEST):</label>
                <input type="text" id="firma" value="TestCorp" required>
                
                <label for="data">Data aplikowania:</label>
                <input type="date" id="data" required>
                
                <label for="status">Status:</label>
                <select id="status" required>
                    <option value="">Wybierz status...</option>
                    <option value="Wys≈Çano CV" selected>Wys≈Çano CV</option>
                    <option value="Rozmowa telefoniczna">Rozmowa telefoniczna</option>
                    <option value="Odrzucono">Odrzucono</option>
                </select>
                
                <button type="submit">üß™ Dodaj TEST aplikacjƒô</button>
            </form>
            
            <div id="testResult" class="status" style="display: none;"></div>
        </div>
        
        <div style="margin-top: 30px;">
            <button onclick="window.location.href='add-application.html'">
                üìù Przejd≈∫ do prawdziwego formularza
            </button>
            <button onclick="window.location.href='index.html'">
                üè† Powr√≥t do g≈Ç√≥wnej strony
            </button>
        </div>
    </div>

    <script type="module">
        // Firebase v10 imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
            authDomain: "rekrutracker-app.firebaseapp.com",
            projectId: "rekrutracker-app",
            storageBucket: "rekrutracker-app.firebasestorage.app",
            messagingSenderId: "758407291898",
            appId: "1:758407291898:web:a573e2cd3b416596d37a43",
            measurementId: "G-HQW1YLG9Q1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        console.log('Firebase initialized successfully');
        
        // Update Firebase status
        document.getElementById('firebaseStatus').innerHTML = '‚úÖ Firebase zainicjalizowany pomy≈õlnie';
        document.getElementById('firebaseStatus').className = 'status success';

        // Set default date to today
        document.getElementById('data').value = new Date().toISOString().split('T')[0];

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            const authStatus = document.getElementById('authStatus');
            const testForm = document.getElementById('testForm');
            
            if (user) {
                authStatus.innerHTML = `‚úÖ Zalogowany jako: <strong>${user.email}</strong><br>UID: ${user.uid}`;
                authStatus.className = 'status success';
                testForm.style.display = 'block';
                
                console.log('User authenticated:', user.email);
            } else {
                authStatus.innerHTML = '‚ùå Nie jeste≈õ zalogowany. <a href="login.html">Zaloguj siƒô</a>';
                authStatus.className = 'status error';
                testForm.style.display = 'none';
                
                console.log('User not authenticated');
            }
        });

        // Handle form submission
        document.getElementById('addTestApplication').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const user = auth.currentUser;
            if (!user) {
                showResult('‚ùå B≈ÇƒÖd: Nie jeste≈õ zalogowany!', 'error');
                return;
            }

            const testResult = document.getElementById('testResult');
            testResult.style.display = 'block';
            testResult.innerHTML = '‚è≥ Dodawanie testowej aplikacji...';
            testResult.className = 'status info';

            try {
                const applicationData = {
                    stanowisko: document.getElementById('stanowisko').value,
                    firma: document.getElementById('firma').value,
                    data: document.getElementById('data').value,
                    status: document.getElementById('status').value,
                    tryb: 'ZDALNY',
                    rodzaj: 'PELNY_ETAT',
                    umowa: 'UMOWA_O_PRACE',
                    waluta: 'PLN',
                    wynRodzaj: 'BRUTTO',
                    statusHistory: [{
                        status: document.getElementById('status').value,
                        date: document.getElementById('data').value
                    }],
                    archiwalna: false,
                    favorite: false,
                    userId: user.uid,
                    createdAt: serverTimestamp(),
                    testApplication: true // Mark as test
                };

                console.log('Saving test application:', applicationData);
                
                const docRef = await addDoc(collection(db, "applications"), applicationData);
                
                console.log('Test application saved with ID:', docRef.id);
                
                showResult(`‚úÖ Sukces! Testowa aplikacja zosta≈Ça dodana!<br>ID: ${docRef.id}`, 'success');
                
                // Reset form
                this.reset();
                document.getElementById('data').value = new Date().toISOString().split('T')[0];
                
            } catch (error) {
                console.error('Error adding test application:', error);
                
                let errorMessage = '‚ùå B≈ÇƒÖd podczas dodawania aplikacji:<br>';
                if (error.code) {
                    switch(error.code) {
                        case 'permission-denied':
                            errorMessage += 'Brak uprawnie≈Ñ. Sprawd≈∫ regu≈Çy Firebase.';
                            break;
                        case 'unauthenticated':
                            errorMessage += 'Brak uwierzytelnienia.';
                            break;
                        default:
                            errorMessage += `Kod b≈Çƒôdu: ${error.code}<br>Wiadomo≈õƒá: ${error.message}`;
                    }
                } else {
                    errorMessage += error.message;
                }
                
                showResult(errorMessage, 'error');
            }
        });

        function showResult(message, type) {
            const testResult = document.getElementById('testResult');
            testResult.innerHTML = message;
            testResult.className = `status ${type}`;
            testResult.style.display = 'block';
        }
    </script>
</body>
</html>
