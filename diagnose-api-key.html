<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Test Firebase - auth/api-key-not-valid</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #e74c3c;
            text-align: center;
        }

        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .config {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ Diagnoza bÅ‚Ä™du: auth/api-key-not-valid</h1>

        <div class="status error">
            <strong>âŒ BÅ‚Ä…d:</strong> Firebase: Error (auth/api-key-not-valid. Please pass a valid API key.)
        </div>

        <div class="config">
            <strong>ğŸ”§ Testowana konfiguracja:</strong><br>
            apiKey: "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw"<br>
            authDomain: "aplikacje-3068f.firebaseapp.com"<br>
            projectId: "aplikacje-3068f"<br>
            storageBucket: "aplikacje-3068f.appspot.com"<br>
            messagingSenderId: "869193309880"<br>
            appId: "1:869193309880:web:c3b31e6b4b18e7e2dccde1"
        </div>

        <div class="status info">
            <strong>ğŸ¯ Cel:</strong> OkreÅ›liÄ‡ dokÅ‚adnie gdzie i dlaczego wystÄ…piÅ‚ bÅ‚Ä…d z API Key
        </div>

        <button onclick="testCurrentConfig()">ğŸ§ª Test aktualnej konfiguracji</button>
        <button onclick="testGoogleLogin()">ğŸ” Test logowania Google</button>
        <button onclick="testFirestoreAccess()">ğŸ“Š Test dostÄ™pu do Firestore</button>
        <button onclick="testAlternativeConfigs()">ğŸ”„ Test alternatywnych konfiguracji</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ WyczyÅ›Ä‡ log</button>

        <div id="status-display" class="status info">Gotowy do testowania...</div>
        <div id="log">Logi testÃ³w pojawiÄ… siÄ™ tutaj...\n</div>
    </div>

    <script>
        function log(message, type = 'INFO') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] [${type}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type}] ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status-display');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Log wyczyszczony...\n';
        }

        async function testCurrentConfig() {
            log('ğŸ”„ Rozpoczynam test aktualnej konfiguracji Firebase...');
            updateStatus('Testowanie aktualnej konfiguracji...', 'info');

            try {
                // Import Firebase
                log('ğŸ“¦ Importowanie Firebase modules...');
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');
                const { getFirestore } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');

                log('âœ… Firebase modules zaimportowane pomyÅ›lnie');

                // Aktualna konfiguracja
                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };

                log('ğŸ”§ Inicjalizowanie Firebase z aktualnÄ… konfiguracjÄ…...');
                const app = initializeApp(firebaseConfig);

                log('âœ… Firebase app zainicjalizowany');
                log(`ğŸ“± App name: ${app.name}`);
                log(`ğŸ”‘ Project ID: ${app.options.projectId}`);
                log(`ğŸŒ Auth domain: ${app.options.authDomain}`);
                log(`ğŸ—ï¸ API Key (pierwsze 20 znakÃ³w): ${app.options.apiKey.substring(0, 20)}...`);

                // Test auth
                log('ğŸ” Inicjalizowanie Firebase Auth...');
                const auth = getAuth(app);
                log('âœ… Firebase Auth zainicjalizowany');

                // Test firestore
                log('ğŸ” Inicjalizowanie Firestore...');
                const db = getFirestore(app);
                log('âœ… Firestore zainicjalizowany');

                updateStatus('âœ… Aktualna konfiguracja dziaÅ‚a poprawnie!', 'success');
                log('ğŸ‰ Test aktualnej konfiguracji - SUKCES');

            } catch (error) {
                log(`âŒ BÅÄ„D: ${error.message}`, 'ERROR');
                log(`ğŸ” Error code: ${error.code || 'brak kodu bÅ‚Ä™du'}`, 'ERROR');
                log(`ğŸ“ Stack trace: ${error.stack}`, 'ERROR');

                if (error.message.includes('api-key-not-valid') || error.code === 'auth/api-key-not-valid') {
                    updateStatus('âŒ API Key jest nieprawidÅ‚owy!', 'error');
                    log('ğŸ’¡ DIAGNOZA: API Key nie jest rozpoznawany przez Firebase', 'WARNING');
                    log('ğŸ’¡ ROZWIÄ„ZANIE: Musisz pobraÄ‡ nowÄ… konfiguracjÄ™ z Firebase Console', 'WARNING');
                } else {
                    updateStatus(`âŒ BÅ‚Ä…d: ${error.message}`, 'error');
                }
            }
        }

        async function testGoogleLogin() {
            log('ğŸ”„ Test logowania Google...');
            updateStatus('Testowanie logowania Google...', 'info');

            try {
                // Import modules
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth, GoogleAuthProvider, signInWithPopup } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const provider = new GoogleAuthProvider();

                log('âœ… Google Provider utworzony');
                log('ğŸ“± PrÃ³ba otwarcia popup logowania...');

                // Ten test prawdopodobnie siÄ™ nie powiedzie z powodu nieprawidÅ‚owego API Key
                const result = await signInWithPopup(auth, provider);

                log(`âœ… Logowanie Google udane! User: ${result.user.email}`);
                updateStatus('âœ… Logowanie Google dziaÅ‚a!', 'success');

            } catch (error) {
                log(`âŒ BÅÄ„D logowania Google: ${error.message}`, 'ERROR');
                log(`ğŸ” Error code: ${error.code}`, 'ERROR');

                if (error.code === 'auth/api-key-not-valid') {
                    updateStatus('âŒ BÅ‚Ä…d API Key podczas logowania', 'error');
                    log('ğŸ’¡ POTWIERDZONE: API Key nie dziaÅ‚a z Google Auth', 'WARNING');
                } else if (error.code === 'auth/unauthorized-domain') {
                    updateStatus('âš ï¸ Problem z autoryzacjÄ… domeny', 'warning');
                    log('ğŸ’¡ To inny problem - domena nie jest autoryzowana', 'INFO');
                } else {
                    updateStatus(`âŒ BÅ‚Ä…d logowania: ${error.code}`, 'error');
                }
            }
        }

        async function testFirestoreAccess() {
            log('ğŸ”„ Test dostÄ™pu do Firestore...');
            updateStatus('Testowanie dostÄ™pu do Firestore...', 'info');

            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getFirestore, collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');

                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };

                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);

                log('ğŸ” PrÃ³ba dostÄ™pu do kolekcji aplikacje...');
                const aplikacjeRef = collection(db, 'aplikacje');
                const snapshot = await getDocs(aplikacjeRef);

                log(`âœ… Firestore dziaÅ‚a! DokumentÃ³w: ${snapshot.size}`);
                updateStatus('âœ… Firestore jest dostÄ™pny', 'success');

            } catch (error) {
                log(`âŒ BÅÄ„D Firestore: ${error.message}`, 'ERROR');
                log(`ğŸ” Error code: ${error.code}`, 'ERROR');

                if (error.code === 'permission-denied') {
                    updateStatus('âš ï¸ Brak uprawnieÅ„ (normalne bez logowania)', 'warning');
                    log('ğŸ’¡ To jest normalne - Firestore wymaga autentykacji', 'INFO');
                } else if (error.message.includes('api-key-not-valid')) {
                    updateStatus('âŒ API Key nie dziaÅ‚a z Firestore', 'error');
                    log('ğŸ’¡ POTWIERDZONE: API Key jest nieprawidÅ‚owy dla Firestore', 'WARNING');
                } else {
                    updateStatus(`âŒ BÅ‚Ä…d Firestore: ${error.code}`, 'error');
                }
            }
        }

        async function testAlternativeConfigs() {
            log('ğŸ”„ Test alternatywnych konfiguracji...');
            updateStatus('Testowanie alternatywnych konfiguracji...', 'info');

            // Lista moÅ¼liwych alternatywnych konfiguracji
            const alternativeConfigs = [
                {
                    name: "Backup Config 1",
                    config: {
                        apiKey: "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw",
                        authDomain: "aplikacje-3068f.firebaseapp.com",
                        databaseURL: "https://aplikacje-3068f-default-rtdb.firebaseio.com",
                        projectId: "aplikacje-3068f",
                        storageBucket: "aplikacje-3068f.appspot.com",
                        messagingSenderId: "869193309880",
                        appId: "1:869193309880:web:c3b31e6b4b18e7e2dccde1"
                    }
                }
            ];

            log('ğŸ’¡ UWAGA: W przypadku bÅ‚Ä™du API Key, alternatywne konfiguracje nie pomogÄ…');
            log('ğŸ’¡ Problem leÅ¼y w samym kluczu API, nie w strukturze konfiguracji');
            log('ğŸ’¡ ROZWIÄ„ZANIE: Pobierz nowÄ… konfiguracjÄ™ z Firebase Console');

            updateStatus('âš ï¸ API Key wymaga aktualizacji z Firebase Console', 'warning');
        }

        // Auto-start test
        setTimeout(() => {
            log('ğŸš€ Automatyczne uruchomienie testu...');
            testCurrentConfig();
        }, 1000);
    </script>
</body>

</html>