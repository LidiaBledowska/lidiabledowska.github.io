<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation - RekruTracker Fix</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .validation-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .test-section {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background-color: #fafafa;
        }

        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .log-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="validation-container">
        <h1>ðŸ”§ RekruTracker Real-time Fix Validation</h1>

        <div class="test-section">
            <h2>1. Core Functions Availability</h2>
            <button onclick="testCoreFunctions()">Test Core Functions</button>
            <div id="core-functions-result"></div>
        </div>

        <div class="test-section">
            <h2>2. Real-time Listener Status</h2>
            <button onclick="testRealtimeListener()">Check Listener Status</button>
            <div id="listener-result"></div>
        </div>

        <div class="test-section">
            <h2>3. Filter Management</h2>
            <button onclick="testFilterManagement()">Test Filter Functions</button>
            <div id="filter-result"></div>
        </div>

        <div class="test-section">
            <h2>4. Firebase Connection</h2>
            <button onclick="testFirebaseConnection()">Test Firebase</button>
            <div id="firebase-result"></div>
        </div>

        <div class="test-section">
            <h2>5. Modal Functions</h2>
            <button onclick="testModalFunctions()">Test Modal Functions</button>
            <div id="modal-result"></div>
        </div>

        <div class="test-section">
            <h2>6. Load Applications with Debug</h2>
            <button onclick="testLoadApplicationsDebug()">Load Applications (Debug Mode)</button>
            <div id="load-apps-result"></div>
            <div id="debug-logs" class="log-output" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>7. End-to-End Test</h2>
            <button onclick="openMainApp()">Open Main App</button>
            <button onclick="openAddAppModal()">Test Add Application</button>
            <div id="e2e-result"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBkqTxIdMfq7ZMOEZEPGlN5vDT1c5Wfq0w",
            authDomain: "rekrutracker.firebaseapp.com",
            projectId: "rekrutracker",
            storageBucket: "rekrutracker.appspot.com",
            messagingSenderId: "891806945901",
            appId: "1:891806945901:web:d4cb5c7f8b9b8e6f9a8b5c"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;

        function showResult(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        function logDebug(message) {
            const debugLogs = document.getElementById('debug-logs');
            debugLogs.style.display = 'block';
            debugLogs.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}\n`;
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }

        window.testCoreFunctions = function () {
            const functions = [
                'loadApplications',
                'getFilters',
                'clearAllFilters',
                'checkListenerStatus',
                'refreshApplications'
            ];

            const results = [];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results.push(`âœ… ${funcName}: Available`);
                } else {
                    results.push(`âŒ ${funcName}: Missing`);
                }
            });

            const allAvailable = results.every(r => r.includes('âœ…'));
            showResult('core-functions-result', results.join('<br>'), allAvailable ? 'success' : 'error');
        };

        window.testRealtimeListener = function () {
            try {
                if (typeof window.checkListenerStatus === 'function') {
                    const status = window.checkListenerStatus();
                    showResult('listener-result', `Listener Status: ${status}`, 'success');
                } else {
                    showResult('listener-result', 'checkListenerStatus function not available', 'error');
                }
            } catch (error) {
                showResult('listener-result', `Error checking listener: ${error.message}`, 'error');
            }
        };

        window.testFilterManagement = function () {
            try {
                if (typeof window.getFilters === 'function' && typeof window.clearAllFilters === 'function') {
                    const filters = window.getFilters();
                    showResult('filter-result',
                        `âœ… Filter functions available<br>Current filters: ${JSON.stringify(filters)}`,
                        'success'
                    );
                } else {
                    showResult('filter-result', 'Filter functions not available', 'error');
                }
            } catch (error) {
                showResult('filter-result', `Error testing filters: ${error.message}`, 'error');
            }
        };

        window.testFirebaseConnection = function () {
            try {
                if (window.db) {
                    showResult('firebase-result', 'âœ… Firebase connection established', 'success');
                } else {
                    showResult('firebase-result', 'âŒ Firebase not connected', 'error');
                }
            } catch (error) {
                showResult('firebase-result', `Error: ${error.message}`, 'error');
            }
        };

        window.testModalFunctions = function () {
            const modalFunctions = ['openAddAppModal', 'closeAddAppModal'];
            const results = [];

            modalFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results.push(`âœ… ${funcName}: Available`);
                } else {
                    results.push(`âŒ ${funcName}: Missing`);
                }
            });

            const allAvailable = results.every(r => r.includes('âœ…'));
            showResult('modal-result', results.join('<br>'), allAvailable ? 'success' : 'error');
        };

        window.testLoadApplicationsDebug = function () {
            try {
                logDebug('Testing loadApplications function...');

                if (typeof window.loadApplications === 'function') {
                    logDebug('loadApplications function found, calling...');
                    window.loadApplications();
                    showResult('load-apps-result', 'âœ… loadApplications called successfully. Check debug logs below.', 'success');
                } else {
                    showResult('load-apps-result', 'âŒ loadApplications function not available', 'error');
                }
            } catch (error) {
                logDebug(`Error: ${error.message}`);
                showResult('load-apps-result', `Error: ${error.message}`, 'error');
            }
        };

        window.openMainApp = function () {
            window.open('http://localhost:8080', '_blank');
            showResult('e2e-result', 'âœ… Main app opened in new tab', 'success');
        };

        window.openAddAppModal = function () {
            if (typeof window.openAddAppModal === 'function') {
                window.openAddAppModal();
                showResult('e2e-result', 'âœ… Add application modal function called', 'success');
            } else {
                showResult('e2e-result', 'âŒ Add application modal function not available', 'error');
            }
        };

        // Auto-run some tests on page load
        setTimeout(() => {
            testCoreFunctions();
            testFirebaseConnection();
        }, 1000);
    </script>
</body>

</html>