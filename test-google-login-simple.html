<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test logowania Google - Prosty</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .login-btn {
            background: #4285f4;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .login-btn:hover {
            background: #357ae8;
        }

        .login-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #cce7ff;
            color: #004085;
        }

        .loading {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” Test Google Login</h1>

        <button id="google-login-btn" class="login-btn">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="20"
                height="20">
            Zaloguj siÄ™ przez Google
        </button>

        <button id="logout-btn" class="login-btn" style="display: none; background: #dc3545;">
            Wyloguj siÄ™
        </button>

        <div id="status" class="status info">Kliknij przycisk powyÅ¼ej aby siÄ™ zalogowaÄ‡</div>

        <div id="user-info" style="display: none; margin-top: 20px;">
            <h3>Informacje o uÅ¼ytkowniku:</h3>
            <p><strong>Nazwa:</strong> <span id="user-name"></span></p>
            <p><strong>Email:</strong> <span id="user-email"></span></p>
            <p><strong>ZdjÄ™cie:</strong> <img id="user-photo" style="width: 50px; height: 50px; border-radius: 50%;">
            </p>
        </div>

        <h2>ğŸ› ï¸ RozwiÄ…zywanie problemÃ³w</h2>
        <div style="text-align: left; max-width: 500px; margin: 0 auto;">
            <h3>JeÅ›li nie dziaÅ‚a:</h3>
            <ol>
                <li><strong>SprawdÅº popup:</strong> Czy przeglÄ…darka nie blokuje popup?</li>
                <li><strong>SprawdÅº domenÄ™:</strong> Czy localhost:8082 jest w Firebase Console?</li>
                <li><strong>SprawdÅº Google Auth:</strong> Czy jest wÅ‚Ä…czony w Firebase?</li>
                <li><strong>SprawdÅº bÅ‚Ä™dy:</strong> OtwÃ³rz Developer Tools (F12) â†’ Console</li>
            </ol>

            <h3>NajczÄ™stsze bÅ‚Ä™dy:</h3>
            <ul>
                <li><code>auth/unauthorized-domain</code> â†’ Dodaj domenÄ™ w Firebase Console</li>
                <li><code>auth/popup-blocked</code> â†’ Odblokuj popup w przeglÄ…darce</li>
                <li><code>auth/popup-closed-by-user</code> â†’ Nie zamykaj popup</li>
            </ul>
        </div>
    </div>

    <script type="module">
        // Firebase konfiguracja
        const firebaseConfig = {
            apiKey: "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw",
            authDomain: "aplikacje-3068f.firebaseapp.com",
            projectId: "aplikacje-3068f",
            storageBucket: "aplikacje-3068f.appspot.com",
            messagingSenderId: "869193309880",
            appId: "1:869193309880:web:c3b31e6b4b18e7e2dccde1"
        };

        let auth, provider;

        async function initFirebase() {
            try {
                // Import Firebase modules
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } =
                    await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                provider = new GoogleAuthProvider();

                console.log('âœ… Firebase initialized successfully');
                updateStatus('Firebase zainicjalizowany - gotowy do logowania', 'success');

                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        showUserInfo(user);
                    } else {
                        hideUserInfo();
                    }
                });

                return { auth, provider, signInWithPopup, signOut };

            } catch (error) {
                console.error('âŒ Firebase initialization error:', error);
                updateStatus(`BÅ‚Ä…d inicjalizacji Firebase: ${error.message}`, 'error');
                throw error;
            }
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function showUserInfo(user) {
            document.getElementById('user-name').textContent = user.displayName || 'Brak nazwy';
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('user-photo').src = user.photoURL || '';
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('google-login-btn').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'inline-flex';
            updateStatus(`Zalogowano jako: ${user.displayName || user.email}`, 'success');
        }

        function hideUserInfo() {
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('google-login-btn').style.display = 'inline-flex';
            document.getElementById('logout-btn').style.display = 'none';
            updateStatus('Nie jesteÅ› zalogowany', 'info');
        }

        // Initialize Firebase when page loads
        initFirebase().then(({ signInWithPopup, signOut }) => {

            // Google login button handler
            document.getElementById('google-login-btn').addEventListener('click', async () => {
                const btn = document.getElementById('google-login-btn');
                const originalText = btn.innerHTML;

                try {
                    btn.disabled = true;
                    btn.innerHTML = 'ğŸ”„ Logowanie...';
                    updateStatus('Otwieranie popup Google...', 'loading');

                    console.log('ğŸ” Attempting Google sign in...');
                    const result = await signInWithPopup(auth, provider);

                    console.log('âœ… Sign in successful:', result.user.email);
                    updateStatus('Logowanie zakoÅ„czone sukcesem!', 'success');

                } catch (error) {
                    console.error('âŒ Sign in error:', error);

                    let errorMessage = 'Nieznany bÅ‚Ä…d logowania';

                    switch (error.code) {
                        case 'auth/popup-closed-by-user':
                            errorMessage = 'Popup zostaÅ‚ zamkniÄ™ty. SprÃ³buj ponownie i nie zamykaj okna logowania.';
                            break;
                        case 'auth/popup-blocked':
                            errorMessage = 'Popup zablokowany przez przeglÄ…darkÄ™. SprawdÅº ustawienia blokady popup.';
                            break;
                        case 'auth/unauthorized-domain':
                            errorMessage = 'Domena nieautoryzowana. Skontaktuj siÄ™ z administratorem.';
                            break;
                        case 'auth/cancelled-popup-request':
                            errorMessage = 'Poprzednie Å¼Ä…danie zostaÅ‚o anulowane. SprÃ³buj ponownie.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'BÅ‚Ä…d poÅ‚Ä…czenia sieciowego. SprawdÅº poÅ‚Ä…czenie internetowe.';
                            break;
                        default:
                            errorMessage = `${error.code}: ${error.message}`;
                    }

                    updateStatus(errorMessage, 'error');

                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            });

            // Logout button handler
            document.getElementById('logout-btn').addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    console.log('âœ… Sign out successful');
                    updateStatus('Wylogowano pomyÅ›lnie', 'success');
                } catch (error) {
                    console.error('âŒ Sign out error:', error);
                    updateStatus(`BÅ‚Ä…d wylogowania: ${error.message}`, 'error');
                }
            });

        }).catch(error => {
            console.error('âŒ Failed to initialize Firebase:', error);
            updateStatus(`Nie udaÅ‚o siÄ™ zainicjalizowaÄ‡ Firebase: ${error.message}`, 'error');
        });
    </script>
</body>

</html>