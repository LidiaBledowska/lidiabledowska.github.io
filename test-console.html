<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rozmowy Console</title>
    <script src="https://kit.fontawesome.com/5b8f4bb78b.js" crossorigin="anonymous"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-log { background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        button { margin: 5px; padding: 10px 15px; }
    </style>
</head>
<body>
    <h1>Test Rozmowy Functionality</h1>
    
    <div id="test-results"></div>
    
    <button onclick="testCompositeCardGeneration()">Test Composite Card Generation</button>
    <button onclick="testFilteringLogic()">Test Filtering Logic</button>
    <button onclick="testToggleFunction()">Test Toggle Function</button>
    
    <script>
        const testResults = document.getElementById('test-results');
        
        function log(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `test-log ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            testResults.appendChild(div);
        }
        
        function testCompositeCardGeneration() {
            try {
                log('Testing getStatusCardConfig function...');
                
                // Basic structure test for status card config
                const statusConfig = {
                    'Rozmowy': {
                        icon: 'fas fa-comments',
                        color: '#f59e0b',
                        bgColor: '#fef3c7',
                        label: 'Rozmowy',
                        isComposite: true,
                        subStatuses: ['Rozmowa telefoniczna', 'Rozmowa online', 'Rozmowa stacjonarna'],
                        subConfig: {
                            'Rozmowa telefoniczna': {
                                icon: 'fas fa-phone',
                                label: 'Telefoniczna'
                            },
                            'Rozmowa online': {
                                icon: 'fas fa-video',
                                label: 'Online'
                            },
                            'Rozmowa stacjonarna': {
                                icon: 'fas fa-handshake',
                                label: 'Stacjonarna'
                            }
                        }
                    }
                };
                
                const rozmowy = statusConfig['Rozmowy'];
                
                if (!rozmowy) {
                    throw new Error('Rozmowy config not found');
                }
                
                if (!rozmowy.isComposite) {
                    throw new Error('isComposite flag not set');
                }
                
                if (!rozmowy.subStatuses || rozmowy.subStatuses.length !== 3) {
                    throw new Error('subStatuses not properly configured');
                }
                
                if (!rozmowy.subConfig || Object.keys(rozmowy.subConfig).length !== 3) {
                    throw new Error('subConfig not properly configured');
                }
                
                log('✓ Composite card configuration is valid', 'success');
                
            } catch (error) {
                log(`✗ Composite card test failed: ${error.message}`, 'error');
            }
        }
        
        function testFilteringLogic() {
            try {
                log('Testing filtering logic...');
                
                // Test data
                const testApplications = [
                    { id: 1, status: 'Rozmowa telefoniczna' },
                    { id: 2, status: 'Rozmowa online' },
                    { id: 3, status: 'Rozmowa stacjonarna' },
                    { id: 4, status: 'Wysłano CV' },
                    { id: 5, status: 'Oferta' }
                ];
                
                // Test "Rozmowy" filter logic
                const interviewStatuses = ['Rozmowa telefoniczna', 'Rozmowa online', 'Rozmowa stacjonarna'];
                const rozmowy = testApplications.filter(app => 
                    interviewStatuses.includes(app.status)
                );
                
                if (rozmowy.length !== 3) {
                    throw new Error(`Expected 3 interview applications, got ${rozmowy.length}`);
                }
                
                // Test specific sub-status filtering
                const telefoniczna = testApplications.filter(app => 
                    app.status === 'Rozmowa telefoniczna'
                );
                
                if (telefoniczna.length !== 1) {
                    throw new Error(`Expected 1 telefoniczna application, got ${telefoniczna.length}`);
                }
                
                log('✓ Filtering logic works correctly', 'success');
                
            } catch (error) {
                log(`✗ Filtering test failed: ${error.message}`, 'error');
            }
        }
        
        function testToggleFunction() {
            try {
                log('Testing toggle function structure...');
                
                // Create a mock composite card element
                const mockCard = document.createElement('div');
                mockCard.className = 'composite-card';
                mockCard.innerHTML = `
                    <div class="dropdown-indicator">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="status-card-dropdown" style="display: none;">
                        <div class="status-sub-option">Test Option</div>
                    </div>
                `;
                
                document.body.appendChild(mockCard);
                
                const dropdown = mockCard.querySelector('.status-card-dropdown');
                const chevron = mockCard.querySelector('.dropdown-indicator i');
                
                if (!dropdown) {
                    throw new Error('Dropdown element not found');
                }
                
                if (!chevron) {
                    throw new Error('Chevron element not found');
                }
                
                // Test initial state
                if (dropdown.style.display !== 'none') {
                    throw new Error('Dropdown should be initially hidden');
                }
                
                if (!chevron.classList.contains('fa-chevron-down')) {
                    throw new Error('Chevron should initially point down');
                }
                
                // Test toggle (simulate opening)
                dropdown.style.display = 'block';
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-up');
                
                if (dropdown.style.display !== 'block') {
                    throw new Error('Dropdown should be visible after toggle');
                }
                
                if (!chevron.classList.contains('fa-chevron-up')) {
                    throw new Error('Chevron should point up when open');
                }
                
                // Clean up
                document.body.removeChild(mockCard);
                
                log('✓ Toggle function structure is correct', 'success');
                
            } catch (error) {
                log(`✗ Toggle test failed: ${error.message}`, 'error');
            }
        }
        
        // Run initial tests on load
        window.addEventListener('load', function() {
            log('Starting Rozmowy functionality tests...');
            testCompositeCardGeneration();
            testFilteringLogic();
            testToggleFunction();
            log('Tests completed.');
        });
    </script>
</body>
</html>
