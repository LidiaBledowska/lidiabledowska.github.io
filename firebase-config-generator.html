<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Generator nowej konfiguracji Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #e74c3c;
            text-align: center;
        }

        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .step {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
        }

        .code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .btn {
            display: inline-block;
            background: #007bff;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 5px;
            margin: 5px;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            font-family: monospace;
            font-size: 14px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🔧 Naprawa konfiguracji Firebase</h1>

        <div class="alert error">
            <strong>❌ Problem:</strong> API Key "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw" nie jest prawidłowy
        </div>

        <div class="alert info">
            <strong>📋 Co trzeba zrobić:</strong> Pobrać nową konfigurację z Firebase Console i zaktualizować pliki
            aplikacji
        </div>

        <h2>🔄 Krok 1: Pobierz konfigurację z Firebase Console</h2>

        <div class="step">
            <h3>Instrukcje:</h3>
            <ol>
                <li>Otwórz <a href="https://console.firebase.google.com" target="_blank" class="btn">🔗 Firebase
                        Console</a></li>
                <li>Znajdź projekt <strong>aplikacje-3068f</strong> (lub utwórz nowy jeśli nie istnieje)</li>
                <li>Przejdź do <strong>Project Settings</strong> (ikona koła zębatego)</li>
                <li>W sekcji <strong>"Your apps"</strong> znajdź aplikację webową</li>
                <li>Jeśli nie ma aplikacji webowej, kliknij <strong>"Add app"</strong> i wybierz web (&lt;/&gt;)</li>
                <li>Skopiuj konfigurację JavaScript</li>
            </ol>
        </div>

        <h2>📝 Krok 2: Wklej nową konfigurację</h2>

        <div class="input-group">
            <label for="new-config">Wklej tutaj nową konfigurację Firebase (cały obiekt firebaseConfig):</label>
            <textarea id="new-config" placeholder="const firebaseConfig = {
  apiKey: 'NOWY_API_KEY',
  authDomain: 'aplikacje-3068f.firebaseapp.com',
  projectId: 'aplikacje-3068f',
  storageBucket: 'aplikacje-3068f.appspot.com',
  messagingSenderId: '869193309880',
  appId: 'NOWY_APP_ID'
};"></textarea>
        </div>

        <button onclick="parseAndGenerateUpdates()" class="btn btn-success">🔄 Generuj aktualizacje plików</button>
        <button onclick="testNewConfig()" class="btn">🧪 Testuj nową konfigurację</button>

        <div id="generated-updates" style="display: none;">
            <h2>📁 Pliki do zaktualizowania</h2>

            <div class="step">
                <h3>1. firebase-init.js</h3>
                <div class="code" id="firebase-init-update"></div>
                <button onclick="updateFirebaseInit()" class="btn btn-success">✅ Zaktualizuj firebase-init.js</button>
            </div>

            <div class="step">
                <h3>2. add-application.js</h3>
                <div class="code" id="add-application-update"></div>
                <button onclick="updateAddApplication()" class="btn btn-success">✅ Zaktualizuj
                    add-application.js</button>
            </div>

            <div class="step">
                <h3>3. Lista wszystkich plików do aktualizacji</h3>
                <div id="files-list"></div>
                <button onclick="updateAllFiles()" class="btn btn-danger">⚠️ Zaktualizuj WSZYSTKIE pliki</button>
            </div>
        </div>

        <div id="test-results" style="display: none;">
            <h2>🧪 Wyniki testów</h2>
            <div id="test-output" class="code"></div>
        </div>

        <h2>🚨 Plan awaryjny</h2>

        <div class="alert warning">
            <strong>Jeśli projekt aplikacje-3068f nie istnieje:</strong>
        </div>

        <div class="step">
            <h3>Utworzenie nowego projektu Firebase</h3>
            <ol>
                <li>W Firebase Console kliknij <strong>"Create a project"</strong></li>
                <li>Nazwij projekt np. <strong>"rekrutracker-new"</strong></li>
                <li>Włącz Google Analytics (opcjonalnie)</li>
                <li>Po utworzeniu, dodaj aplikację webową</li>
                <li>Skonfiguruj <strong>Authentication</strong> → włącz Google provider</li>
                <li>Skonfiguruj <strong>Firestore Database</strong> → utwórz w trybie test</li>
                <li>Dodaj localhost do <strong>Authorized domains</strong> w Authentication Settings</li>
            </ol>
        </div>

        <button onclick="generateNewProjectConfig()" class="btn">🆕 Generuj konfigurację dla nowego projektu</button>
    </div>

    <script>
        let newConfig = null;

        function parseAndGenerateUpdates() {
            const configText = document.getElementById('new-config').value.trim();

            if (!configText) {
                alert('❌ Proszę wkleić konfigurację Firebase!');
                return;
            }

            try {
                // Extract config object from text
                let configMatch = configText.match(/\{[\s\S]*\}/);
                if (!configMatch) {
                    throw new Error('Nie znaleziono obiektu konfiguracji');
                }

                // Parse the config (unsafe but for this tool it's OK)
                eval('newConfig = ' + configMatch[0]);

                // Validate required fields
                const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
                for (const field of requiredFields) {
                    if (!newConfig[field]) {
                        throw new Error(`Brak wymaganego pola: ${field}`);
                    }
                }

                generateUpdates();
                document.getElementById('generated-updates').style.display = 'block';

            } catch (error) {
                alert(`❌ Błąd parsowania konfiguracji: ${error.message}`);
                console.error('Config parse error:', error);
            }
        }

        function generateUpdates() {
            // Generate firebase-init.js update
            const firebaseInitUpdate = `const firebaseConfig = {
    apiKey: "${newConfig.apiKey}",
    authDomain: "${newConfig.authDomain}",
    projectId: "${newConfig.projectId}",
    storageBucket: "${newConfig.storageBucket}",
    messagingSenderId: "${newConfig.messagingSenderId}",
    appId: "${newConfig.appId}"
};`;

            document.getElementById('firebase-init-update').textContent = firebaseInitUpdate;
            document.getElementById('add-application-update').textContent = firebaseInitUpdate;

            // Generate files list
            const files = [
                'firebase-init.js',
                'add-application.js',
                'login.html (w sekcji script)',
                'register.html',
                'conversations.html',
                'ai-assistant.html',
                'analytics.html',
                'smart-followup.html',
                'debug-*.html (pliki testowe)',
                'test-*.html (pliki testowe)'
            ];

            document.getElementById('files-list').innerHTML = files.map(file =>
                `<div>📁 ${file}</div>`
            ).join('');
        }

        async function updateFirebaseInit() {
            if (!newConfig) {
                alert('❌ Brak nowej konfiguracji!');
                return;
            }

            try {
                const response = await fetch('/firebase-init.js');
                const currentContent = await response.text();

                // Replace the config object
                const newContent = currentContent.replace(
                    /const firebaseConfig = \{[\s\S]*?\};/,
                    `const firebaseConfig = {
    apiKey: "${newConfig.apiKey}",
    authDomain: "${newConfig.authDomain}",
    projectId: "${newConfig.projectId}",
    storageBucket: "${newConfig.storageBucket}",
    messagingSenderId: "${newConfig.messagingSenderId}",
    appId: "${newConfig.appId}"
};`
                );

                // Note: This would require server-side support to actually save the file
                console.log('New firebase-init.js content:', newContent);
                alert('✅ Konfiguracja wygenerowana! (Wymagane ręczne kopiowanie do pliku)');

            } catch (error) {
                alert(`❌ Błąd: ${error.message}`);
            }
        }

        async function testNewConfig() {
            if (!newConfig) {
                alert('❌ Najpierw wklej i sparsuj nową konfigurację!');
                return;
            }

            document.getElementById('test-results').style.display = 'block';
            const output = document.getElementById('test-output');
            output.textContent = 'Testowanie nowej konfiguracji...\n';

            try {
                // Import Firebase
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                output.textContent += '✅ Firebase modules zaimportowane\n';

                // Test new config
                const app = initializeApp(newConfig, 'test-app');
                const auth = getAuth(app);

                output.textContent += '✅ Firebase zainicjalizowany z nową konfiguracją\n';
                output.textContent += `📱 Project ID: ${app.options.projectId}\n`;
                output.textContent += `🔑 API Key: ${app.options.apiKey.substring(0, 20)}...\n`;
                output.textContent += `🌐 Auth domain: ${app.options.authDomain}\n`;
                output.textContent += '\n🎉 NOWA KONFIGURACJA DZIAŁA!\n';
                output.textContent += '\n✅ Możesz teraz zaktualizować pliki aplikacji.';

            } catch (error) {
                output.textContent += `\n❌ BŁĄD: ${error.message}\n`;
                output.textContent += `🔍 Error code: ${error.code}\n`;

                if (error.message.includes('api-key-not-valid')) {
                    output.textContent += '\n💡 Nowa konfiguracja też ma nieprawidłowy API Key!\n';
                    output.textContent += '💡 Sprawdź czy skopiowałeś poprawną konfigurację z Firebase Console.\n';
                }
            }
        }

        function generateNewProjectConfig() {
            const newProjectConfig = `// Konfiguracja dla nowego projektu Firebase
const firebaseConfig = {
    apiKey: "NOWY_API_KEY_Z_FIREBASE_CONSOLE",
    authDomain: "NOWY_PROJECT_ID.firebaseapp.com",
    projectId: "NOWY_PROJECT_ID",
    storageBucket: "NOWY_PROJECT_ID.appspot.com",
    messagingSenderId: "NOWY_MESSAGING_SENDER_ID",
    appId: "NOWY_APP_ID"
};

// Kroki po utworzeniu nowego projektu:
// 1. Zastąp wszystkie wartości rzeczywistymi z Firebase Console
// 2. Skonfiguruj Authentication (włącz Google provider)
// 3. Skonfiguruj Firestore Database
// 4. Dodaj localhost do Authorized domains
// 5. Przetestuj konfigurację używając tego narzędzia`;

            document.getElementById('new-config').value = newProjectConfig;
            alert('📝 Wygenerowano szablon konfiguracji dla nowego projektu!\nZastąp wartości rzeczywistymi z Firebase Console.');
        }

        // Show instructions on load
        window.addEventListener('load', () => {
            console.log('🔧 Generator konfiguracji Firebase gotowy');
            console.log('📋 Aby naprawić błąd auth/api-key-not-valid:');
            console.log('1. Pobierz nową konfigurację z Firebase Console');
            console.log('2. Wklej ją w formularz powyżej');
            console.log('3. Kliknij "Generuj aktualizacje plików"');
            console.log('4. Zaktualizuj pliki aplikacji');
        });
    </script>
</body>

</html>