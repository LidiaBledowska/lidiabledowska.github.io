<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Google Auth - Test z Redirect</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .login-btn {
            background: #4285f4;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .login-btn:hover {
            background: #357ae8;
        }

        .login-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .method-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #cce7ff;
            color: #004085;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîê Test Google Auth - R√≥≈ºne metody</h1>

        <div id="status" class="status info">Wybierz metodƒô logowania do przetestowania</div>

        <div class="method-card">
            <h3>ü™ü Metoda 1: Popup (standardowa)</h3>
            <p>Otwiera popup Google w nowym oknie</p>
            <button id="popup-login" class="login-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" height="20">
                Test Popup Login
            </button>
            <div id="popup-result"></div>
        </div>

        <div class="method-card">
            <h3>üîÑ Metoda 2: Redirect</h3>
            <p>Przekierowuje ca≈ÇƒÖ stronƒô do Google</p>
            <button id="redirect-login" class="login-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" height="20">
                Test Redirect Login
            </button>
            <div id="redirect-result"></div>
        </div>

        <div class="method-card">
            <h3>üåê Metoda 3: Bezpo≈õredni URL</h3>
            <p>Link bezpo≈õrednio do Google OAuth</p>
            <a id="direct-login" class="login-btn" href="#" target="_blank">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" height="20">
                Test Direct URL
            </a>
            <div id="direct-result"></div>
        </div>

        <div id="user-info" style="display: none; margin-top: 20px; text-align: left;">
            <h3>‚úÖ Zalogowany u≈ºytkownik:</h3>
            <p><strong>Nazwa:</strong> <span id="user-name"></span></p>
            <p><strong>Email:</strong> <span id="user-email"></span></p>
            <p><strong>Metoda:</strong> <span id="login-method"></span></p>
            <button id="logout-btn" class="login-btn" style="background: #dc3545;">Wyloguj</button>
        </div>

        <div style="margin-top: 30px; font-size: 14px; color: #666;">
            <p><strong>Cel:</strong> Sprawdzenie kt√≥ra metoda obejdzie problem z unauthorized domain</p>
            <p><strong>Uwaga:</strong> W produkcji u≈ºywaj metody popup po skonfigurowaniu Firebase Console</p>
        </div>
    </div>

    <script type="module">
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw",
            authDomain: "aplikacje-3068f.firebaseapp.com",
            projectId: "aplikacje-3068f",
            storageBucket: "aplikacje-3068f.appspot.com",
            messagingSenderId: "869193309880",
            appId: "1:869193309880:web:c3b31e6b4b18e7e2dccde1"
        };

        let auth, provider;

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function showUserInfo(user, method) {
            document.getElementById('user-name').textContent = user.displayName || 'Brak nazwy';
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('login-method').textContent = method;
            document.getElementById('user-info').style.display = 'block';
            updateStatus(`Zalogowano przez ${method}: ${user.email}`, 'success');
        }

        function hideUserInfo() {
            document.getElementById('user-info').style.display = 'none';
        }

        async function initFirebase() {
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut, onAuthStateChanged } =
                    await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                provider = new GoogleAuthProvider();

                // Add scopes
                provider.addScope('email');
                provider.addScope('profile');

                console.log('‚úÖ Firebase initialized');
                updateStatus('Firebase zainicjalizowany - wybierz metodƒô logowania', 'success');

                // Check for redirect result
                try {
                    const result = await getRedirectResult(auth);
                    if (result) {
                        console.log('‚úÖ Redirect login successful:', result.user.email);
                        showUserInfo(result.user, 'Redirect');
                    }
                } catch (redirectError) {
                    console.log('No redirect result or redirect failed:', redirectError.message);
                }

                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user && !document.getElementById('user-info').style.display !== 'none') {
                        showUserInfo(user, 'Auto-login');
                    }
                });

                return { signInWithPopup, signInWithRedirect, signOut };

            } catch (error) {
                console.error('‚ùå Firebase init error:', error);
                updateStatus(`B≈ÇƒÖd Firebase: ${error.message}`, 'error');
                throw error;
            }
        }

        // Initialize Firebase and setup handlers
        initFirebase().then(({ signInWithPopup, signInWithRedirect, signOut }) => {

            // Method 1: Popup login
            document.getElementById('popup-login').addEventListener('click', async () => {
                const btn = document.getElementById('popup-login');
                const resultDiv = document.getElementById('popup-result');
                const originalText = btn.innerHTML;

                try {
                    btn.disabled = true;
                    btn.innerHTML = 'üîÑ Otwieranie popup...';
                    updateStatus('Popup method - otwieranie popup Google...', 'warning');

                    const result = await signInWithPopup(auth, provider);
                    console.log('‚úÖ Popup login successful:', result.user.email);
                    showUserInfo(result.user, 'Popup');
                    resultDiv.innerHTML = '<p style="color: green;">‚úÖ Popup login successful!</p>';

                } catch (error) {
                    console.error('‚ùå Popup login error:', error);
                    let errorMsg = `‚ùå Popup failed: ${error.code}`;
                    if (error.code === 'auth/unauthorized-domain') {
                        errorMsg += ' (Expected - domain not authorized)';
                    }
                    resultDiv.innerHTML = `<p style="color: red;">${errorMsg}</p>`;
                    updateStatus(`Popup method failed: ${error.code}`, 'error');

                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            });

            // Method 2: Redirect login
            document.getElementById('redirect-login').addEventListener('click', async () => {
                const btn = document.getElementById('redirect-login');
                const resultDiv = document.getElementById('redirect-result');

                try {
                    btn.disabled = true;
                    btn.innerHTML = 'üîÑ Przekierowywanie...';
                    updateStatus('Redirect method - przekierowywanie do Google...', 'warning');

                    // This will redirect the entire page
                    await signInWithRedirect(auth, provider);

                } catch (error) {
                    console.error('‚ùå Redirect login error:', error);
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå Redirect failed: ${error.code}</p>`;
                    updateStatus(`Redirect method failed: ${error.code}`, 'error');
                    btn.disabled = false;
                    btn.innerHTML = 'Test Redirect Login';
                }
            });

            // Method 3: Direct URL (workaround)
            document.getElementById('direct-login').addEventListener('click', () => {
                const clientId = '869193309880-PROJECT_CLIENT_ID.apps.googleusercontent.com'; // This would need to be the actual client ID
                const redirectUri = encodeURIComponent(window.location.origin + '/test-google-auth-callback.html');
                const scope = encodeURIComponent('email profile');
                const responseType = 'code';

                const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
                    `client_id=${clientId}&` +
                    `redirect_uri=${redirectUri}&` +
                    `scope=${scope}&` +
                    `response_type=${responseType}&` +
                    `state=test`;

                document.getElementById('direct-result').innerHTML =
                    '<p style="color: blue;">üîó This would need proper OAuth client ID configuration</p>';
                updateStatus('Direct URL method requires manual OAuth setup', 'warning');
            });

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    hideUserInfo();
                    updateStatus('Wylogowano pomy≈õlnie', 'success');

                    // Clear result divs
                    document.getElementById('popup-result').innerHTML = '';
                    document.getElementById('redirect-result').innerHTML = '';
                    document.getElementById('direct-result').innerHTML = '';

                } catch (error) {
                    console.error('‚ùå Logout error:', error);
                    updateStatus(`B≈ÇƒÖd wylogowania: ${error.message}`, 'error');
                }
            });

        }).catch(error => {
            console.error('‚ùå Failed to initialize Firebase:', error);
            updateStatus(`Nie uda≈Ço siƒô zainicjalizowaƒá Firebase: ${error.message}`, 'error');
        });
    </script>
</body>

</html>