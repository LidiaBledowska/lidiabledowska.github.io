<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test API Key Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        #output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîß Test API Key Firebase</h1>

        <div class="test-section info">
            <h3>üìù Cel testu</h3>
            <p>Sprawdza czy Firebase API Key dzia≈Ça poprawnie i czy mo≈ºe po≈ÇƒÖczyƒá siƒô z projektem.</p>
        </div>

        <div class="test-section">
            <h3>üß™ Testy</h3>
            <button onclick="testFirebaseInit()">Test Firebase Init</button>
            <button onclick="testFirebaseAuth()">Test Firebase Auth</button>
            <button onclick="testFirestoreConnection()">Test Firestore</button>
            <button onclick="testGoogleProvider()">Test Google Provider</button>
            <button onclick="clearOutput()">Wyczy≈õƒá logi</button>
        </div>

        <div id="output">Kliknij przycisk testu aby rozpoczƒÖƒá...</div>
    </div>

    <script type="module">
        let auth, db, app;

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        window.clearOutput = function () {
            document.getElementById('output').innerHTML = 'Logi wyczyszczone...<br>';
        }

        window.testFirebaseInit = async function () {
            log('üîÑ Test inicjalizacji Firebase...', 'info');

            try {
                // Import Firebase modules
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');
                const { getFirestore } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');

                log('‚úÖ Firebase modules zaimportowane', 'success');

                // Firebase config
                const firebaseConfig = {
                    apiKey: "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw",
                    authDomain: "aplikacje-3068f.firebaseapp.com",
                    projectId: "aplikacje-3068f",
                    storageBucket: "aplikacje-3068f.appspot.com",
                    messagingSenderId: "869193309880",
                    appId: "1:869193309880:web:c3b31e6b4b18e7e2dccde1"
                };

                log('‚úÖ Firebase config przygotowana', 'info');

                // Initialize Firebase
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                log('‚úÖ Firebase zainicjalizowany pomy≈õlnie!', 'success');
                log(`üì± App name: ${app.name}`, 'info');
                log(`üîë Project ID: ${app.options.projectId}`, 'info');
                log(`üåê Auth domain: ${app.options.authDomain}`, 'info');
                log(`üîó API Key: ${app.options.apiKey.substring(0, 20)}...`, 'info');

            } catch (error) {
                log(`‚ùå B≈ÇƒÖd inicjalizacji Firebase: ${error.message}`, 'error');
                log(`üîç Error code: ${error.code || 'brak kodu'}`, 'error');
                console.error('Firebase init error:', error);
            }
        }

        window.testFirebaseAuth = async function () {
            if (!auth) {
                log('‚ùå Najpierw uruchom test Firebase Init!', 'error');
                return;
            }

            log('üîÑ Test Firebase Auth...', 'info');

            try {
                log(`‚úÖ Auth zainicjalizowany`, 'success');
                log(`üîë Auth config: ${auth.config.apiKey.substring(0, 20)}...`, 'info');
                log(`üåê Auth domain: ${auth.config.authDomain}`, 'info');
                log(`üë§ Current user: ${auth.currentUser ? auth.currentUser.email : 'brak'}`, 'info');

            } catch (error) {
                log(`‚ùå B≈ÇƒÖd Firebase Auth: ${error.message}`, 'error');
                console.error('Firebase auth error:', error);
            }
        }

        window.testFirestoreConnection = async function () {
            if (!db) {
                log('‚ùå Najpierw uruchom test Firebase Init!', 'error');
                return;
            }

            log('üîÑ Test po≈ÇƒÖczenia z Firestore...', 'info');

            try {
                const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');

                log('‚úÖ Firestore modules zaimportowane', 'success');
                log('üîç Pr√≥ba po≈ÇƒÖczenia z kolekcjƒÖ aplikacji...', 'info');

                // Test query - this will fail if API key is invalid
                const aplikacjeRef = collection(db, 'aplikacje');
                const snapshot = await getDocs(aplikacjeRef);

                log(`‚úÖ Po≈ÇƒÖczenie z Firestore udane!`, 'success');
                log(`üìä Liczba dokument√≥w w kolekcji 'aplikacje': ${snapshot.size}`, 'info');

            } catch (error) {
                log(`‚ùå B≈ÇƒÖd po≈ÇƒÖczenia z Firestore: ${error.message}`, 'error');
                log(`üîç Error code: ${error.code || 'brak kodu'}`, 'error');

                if (error.code === 'permission-denied') {
                    log('üí° To mo≈ºe byƒá problem z regu≈Çami bezpiecze≈Ñstwa Firestore', 'warning');
                } else if (error.code && error.code.includes('api-key')) {
                    log('üí° Problem z API Key - sprawd≈∫ konfiguracjƒô Firebase', 'warning');
                }

                console.error('Firestore error:', error);
            }
        }

        window.testGoogleProvider = async function () {
            if (!auth) {
                log('‚ùå Najpierw uruchom test Firebase Init!', 'error');
                return;
            }

            log('üîÑ Test Google Auth Provider...', 'info');

            try {
                const { GoogleAuthProvider } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                const provider = new GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');

                log('‚úÖ Google Provider utworzony pomy≈õlnie', 'success');
                log(`üîë Provider ID: ${provider.providerId}`, 'info');
                log('üìß Scopes: email, profile', 'info');

            } catch (error) {
                log(`‚ùå B≈ÇƒÖd Google Provider: ${error.message}`, 'error');
                console.error('Google provider error:', error);
            }
        }

        // Auto-run basic test
        setTimeout(() => {
            log('üöÄ Automatyczne uruchomienie testu inicjalizacji...', 'info');
            testFirebaseInit();
        }, 1000);
    </script>
</body>

</html>