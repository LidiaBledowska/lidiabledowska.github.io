<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Debug API Key</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        #details {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }

        .config-box {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🔧 Debug API Key Firebase</h1>

        <div class="status info">
            <strong>📋 Sprawdzanie:</strong> Czy API Key jest poprawny i czy Firebase projekt jest aktywny
        </div>

        <div class="config-box">
            <strong>Aktualna konfiguracja Firebase:</strong><br>
            API Key: AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw<br>
            Project ID: aplikacje-3068f<br>
            Auth Domain: aplikacje-3068f.firebaseapp.com
        </div>

        <button onclick="testAPIKey()" id="testBtn">🧪 Sprawdź API Key</button>
        <button onclick="testFullConnection()" id="testFullBtn">🔍 Pełny test połączenia</button>
        <button onclick="testDirectHTTP()" id="testHTTPBtn">🌐 Test bezpośredni HTTP</button>

        <div id="status" class="status info">Kliknij przycisk aby rozpocząć test...</div>
        <div id="details">Szczegóły testów pojawią się tutaj...</div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function addDetail(message) {
            const detailsDiv = document.getElementById('details');
            const timestamp = new Date().toLocaleTimeString();
            detailsDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            detailsDiv.scrollTop = detailsDiv.scrollHeight;
        }

        async function testAPIKey() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = '🔄 Testowanie...';

            updateStatus('Testowanie API Key...', 'info');
            addDetail('🔄 Rozpoczynam test API Key...');

            try {
                // Test 1: Basic Firebase init
                addDetail('📦 Importowanie Firebase modules...');
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                addDetail('✅ Firebase modules zaimportowane');

                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };
                addDetail('🔧 Inicjalizowanie Firebase...');
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);

                addDetail('✅ Firebase zainicjalizowany');
                addDetail(`📱 App name: ${app.name}`);
                addDetail(`🔑 Project ID: ${app.options.projectId}`);
                addDetail(`🌐 Auth domain: ${app.options.authDomain}`);

                // Test 2: Try to access Firebase Auth
                addDetail('🔍 Sprawdzanie dostępu do Auth...');
                if (auth) {
                    addDetail('✅ Firebase Auth dostępny');
                    addDetail(`👤 Current user: ${auth.currentUser ? 'zalogowany' : 'nie zalogowany'}`);
                } else {
                    throw new Error('Firebase Auth niedostępny');
                }

                updateStatus('✅ API Key działa poprawnie!', 'success');
                addDetail('🎉 Test API Key zakończony sukcesem');

            } catch (error) {
                addDetail(`❌ Błąd: ${error.message}`);
                addDetail(`🔍 Error code: ${error.code || 'brak'}`);

                if (error.message.includes('api-key-not-valid')) {
                    updateStatus('❌ API Key jest nieprawidłowy!', 'error');
                    addDetail('💡 Możliwe przyczyny:');
                    addDetail('   - API Key został zmieniony w Firebase Console');
                    addDetail('   - Projekt został usunięty lub wyłączony');
                    addDetail('   - API Key ma ograniczenia IP/domenowe');
                } else {
                    updateStatus(`❌ Błąd: ${error.message}`, 'error');
                }

                console.error('API Key test error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = '🧪 Sprawdź API Key';
            }
        }

        async function testFullConnection() {
            const btn = document.getElementById('testFullBtn');
            btn.disabled = true;
            btn.textContent = '🔄 Testowanie...';

            updateStatus('Testowanie pełnego połączenia...', 'info');
            addDetail('🔄 Rozpoczynam pełny test połączenia...');

            try {
                // Import all modules
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth, GoogleAuthProvider } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');
                const { getFirestore, collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');

                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                addDetail('✅ Firebase zainicjalizowany');

                // Test Google Provider
                const provider = new GoogleAuthProvider();
                addDetail('✅ Google Provider utworzony');

                // Test Firestore connection (this will fail with invalid API key)
                addDetail('🔍 Sprawdzanie połączenia z Firestore...');
                const aplikacjeRef = collection(db, 'aplikacje');
                const snapshot = await getDocs(aplikacjeRef);

                addDetail(`✅ Firestore działa - znaleziono ${snapshot.size} dokumentów`);
                updateStatus('✅ Wszystkie testy przeszły pomyślnie!', 'success');

            } catch (error) {
                addDetail(`❌ Błąd połączenia: ${error.message}`);
                addDetail(`🔍 Error code: ${error.code || 'brak'}`);

                if (error.code === 'permission-denied') {
                    updateStatus('⚠️ Problem z uprawnieniami Firestore', 'warning');
                    addDetail('💡 To normalny błąd - reguły Firestore wymagają autentykacji');
                } else if (error.code && error.code.includes('api-key')) {
                    updateStatus('❌ Problem z API Key', 'error');
                } else {
                    updateStatus(`❌ Błąd: ${error.message}`, 'error');
                }

                console.error('Full connection test error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = '🔍 Pełny test połączenia';
            }
        }

        async function testDirectHTTP() {
            const btn = document.getElementById('testHTTPBtn');
            btn.disabled = true;
            btn.textContent = '🔄 Testowanie...';

            updateStatus('Testowanie bezpośredniego dostępu HTTP...', 'info');
            addDetail('🔄 Rozpoczynam test HTTP...');

            try {
                // Test direct HTTP request to Firebase REST API
                const apiKey = "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw";
                const projectId = "aplikacje-3068f";

                addDetail(`🌐 Testowanie API endpoint dla projektu ${projectId}...`);

                // Test Firebase Auth API
                const authUrl = `https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${apiKey}`;

                addDetail('📡 Wysyłanie request do Firebase Auth API...');

                const response = await fetch(authUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'testpassword123',
                        returnSecureToken: true
                    })
                });

                addDetail(`📨 Response status: ${response.status}`);

                if (response.status === 400) {
                    // This is expected - we're sending a test request
                    const data = await response.json();
                    if (data.error && data.error.message.includes('API_KEY_NOT_VALID')) {
                        addDetail('❌ API Key jest nieprawidłowy!');
                        updateStatus('❌ API Key nie działa - sprawdź Firebase Console', 'error');
                    } else {
                        addDetail('✅ API Key jest prawidłowy (błąd to normalne - test request)');
                        updateStatus('✅ API Key działa poprawnie', 'success');
                    }
                } else if (response.status === 200) {
                    addDetail('✅ API Key działa poprawnie');
                    updateStatus('✅ API Key jest aktywny', 'success');
                } else {
                    addDetail(`⚠️ Nieoczekiwany status: ${response.status}`);
                    updateStatus('⚠️ Nieoczekiwana odpowiedź z Firebase', 'warning');
                }

            } catch (error) {
                addDetail(`❌ Błąd HTTP request: ${error.message}`);
                updateStatus(`❌ Błąd połączenia: ${error.message}`, 'error');
                console.error('HTTP test error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = '🌐 Test bezpośredni HTTP';
            }
        }
    </script>
</body>

</html>