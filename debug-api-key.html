<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Debug API Key</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        #details {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }

        .config-box {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ Debug API Key Firebase</h1>

        <div class="status info">
            <strong>ğŸ“‹ Sprawdzanie:</strong> Czy API Key jest poprawny i czy Firebase projekt jest aktywny
        </div>

        <div class="config-box">
            <strong>Aktualna konfiguracja Firebase:</strong><br>
            API Key: AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw<br>
            Project ID: aplikacje-3068f<br>
            Auth Domain: aplikacje-3068f.firebaseapp.com
        </div>

        <button onclick="testAPIKey()" id="testBtn">ğŸ§ª SprawdÅº API Key</button>
        <button onclick="testFullConnection()" id="testFullBtn">ğŸ” PeÅ‚ny test poÅ‚Ä…czenia</button>
        <button onclick="testDirectHTTP()" id="testHTTPBtn">ğŸŒ Test bezpoÅ›redni HTTP</button>

        <div id="status" class="status info">Kliknij przycisk aby rozpoczÄ…Ä‡ test...</div>
        <div id="details">SzczegÃ³Å‚y testÃ³w pojawiÄ… siÄ™ tutaj...</div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function addDetail(message) {
            const detailsDiv = document.getElementById('details');
            const timestamp = new Date().toLocaleTimeString();
            detailsDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            detailsDiv.scrollTop = detailsDiv.scrollHeight;
        }

        async function testAPIKey() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ Testowanie...';

            updateStatus('Testowanie API Key...', 'info');
            addDetail('ğŸ”„ Rozpoczynam test API Key...');

            try {
                // Test 1: Basic Firebase init
                addDetail('ğŸ“¦ Importowanie Firebase modules...');
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');

                addDetail('âœ… Firebase modules zaimportowane');

                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };
                addDetail('ğŸ”§ Inicjalizowanie Firebase...');
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);

                addDetail('âœ… Firebase zainicjalizowany');
                addDetail(`ğŸ“± App name: ${app.name}`);
                addDetail(`ğŸ”‘ Project ID: ${app.options.projectId}`);
                addDetail(`ğŸŒ Auth domain: ${app.options.authDomain}`);

                // Test 2: Try to access Firebase Auth
                addDetail('ğŸ” Sprawdzanie dostÄ™pu do Auth...');
                if (auth) {
                    addDetail('âœ… Firebase Auth dostÄ™pny');
                    addDetail(`ğŸ‘¤ Current user: ${auth.currentUser ? 'zalogowany' : 'nie zalogowany'}`);
                } else {
                    throw new Error('Firebase Auth niedostÄ™pny');
                }

                updateStatus('âœ… API Key dziaÅ‚a poprawnie!', 'success');
                addDetail('ğŸ‰ Test API Key zakoÅ„czony sukcesem');

            } catch (error) {
                addDetail(`âŒ BÅ‚Ä…d: ${error.message}`);
                addDetail(`ğŸ” Error code: ${error.code || 'brak'}`);

                if (error.message.includes('api-key-not-valid')) {
                    updateStatus('âŒ API Key jest nieprawidÅ‚owy!', 'error');
                    addDetail('ğŸ’¡ MoÅ¼liwe przyczyny:');
                    addDetail('   - API Key zostaÅ‚ zmieniony w Firebase Console');
                    addDetail('   - Projekt zostaÅ‚ usuniÄ™ty lub wyÅ‚Ä…czony');
                    addDetail('   - API Key ma ograniczenia IP/domenowe');
                } else {
                    updateStatus(`âŒ BÅ‚Ä…d: ${error.message}`, 'error');
                }

                console.error('API Key test error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ§ª SprawdÅº API Key';
            }
        }

        async function testFullConnection() {
            const btn = document.getElementById('testFullBtn');
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ Testowanie...';

            updateStatus('Testowanie peÅ‚nego poÅ‚Ä…czenia...', 'info');
            addDetail('ğŸ”„ Rozpoczynam peÅ‚ny test poÅ‚Ä…czenia...');

            try {
                // Import all modules
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js');
                const { getAuth, GoogleAuthProvider } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js');
                const { getFirestore, collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');

                const firebaseConfig = {
                    apiKey: "AIzaSyD7ZLyDHFBNsQe9j03YPi0xmdLbqdk_K68",
                    authDomain: "rekrutracker-app.firebaseapp.com",
                    projectId: "rekrutracker-app",
                    storageBucket: "rekrutracker-app.firebasestorage.app",
                    messagingSenderId: "758407291898",
                    appId: "1:758407291898:web:a573e2cd3b416596d37a43",
                    measurementId: "G-HQW1YLG9Q1"
                };

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                addDetail('âœ… Firebase zainicjalizowany');

                // Test Google Provider
                const provider = new GoogleAuthProvider();
                addDetail('âœ… Google Provider utworzony');

                // Test Firestore connection (this will fail with invalid API key)
                addDetail('ğŸ” Sprawdzanie poÅ‚Ä…czenia z Firestore...');
                const aplikacjeRef = collection(db, 'aplikacje');
                const snapshot = await getDocs(aplikacjeRef);

                addDetail(`âœ… Firestore dziaÅ‚a - znaleziono ${snapshot.size} dokumentÃ³w`);
                updateStatus('âœ… Wszystkie testy przeszÅ‚y pomyÅ›lnie!', 'success');

            } catch (error) {
                addDetail(`âŒ BÅ‚Ä…d poÅ‚Ä…czenia: ${error.message}`);
                addDetail(`ğŸ” Error code: ${error.code || 'brak'}`);

                if (error.code === 'permission-denied') {
                    updateStatus('âš ï¸ Problem z uprawnieniami Firestore', 'warning');
                    addDetail('ğŸ’¡ To normalny bÅ‚Ä…d - reguÅ‚y Firestore wymagajÄ… autentykacji');
                } else if (error.code && error.code.includes('api-key')) {
                    updateStatus('âŒ Problem z API Key', 'error');
                } else {
                    updateStatus(`âŒ BÅ‚Ä…d: ${error.message}`, 'error');
                }

                console.error('Full connection test error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ” PeÅ‚ny test poÅ‚Ä…czenia';
            }
        }

        async function testDirectHTTP() {
            const btn = document.getElementById('testHTTPBtn');
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ Testowanie...';

            updateStatus('Testowanie bezpoÅ›redniego dostÄ™pu HTTP...', 'info');
            addDetail('ğŸ”„ Rozpoczynam test HTTP...');

            try {
                // Test direct HTTP request to Firebase REST API
                const apiKey = "AIzaSyBQ3lWo31mLO2gF9cLG6KZzGLX3a3C7dGw";
                const projectId = "aplikacje-3068f";

                addDetail(`ğŸŒ Testowanie API endpoint dla projektu ${projectId}...`);

                // Test Firebase Auth API
                const authUrl = `https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${apiKey}`;

                addDetail('ğŸ“¡ WysyÅ‚anie request do Firebase Auth API...');

                const response = await fetch(authUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'testpassword123',
                        returnSecureToken: true
                    })
                });

                addDetail(`ğŸ“¨ Response status: ${response.status}`);

                if (response.status === 400) {
                    // This is expected - we're sending a test request
                    const data = await response.json();
                    if (data.error && data.error.message.includes('API_KEY_NOT_VALID')) {
                        addDetail('âŒ API Key jest nieprawidÅ‚owy!');
                        updateStatus('âŒ API Key nie dziaÅ‚a - sprawdÅº Firebase Console', 'error');
                    } else {
                        addDetail('âœ… API Key jest prawidÅ‚owy (bÅ‚Ä…d to normalne - test request)');
                        updateStatus('âœ… API Key dziaÅ‚a poprawnie', 'success');
                    }
                } else if (response.status === 200) {
                    addDetail('âœ… API Key dziaÅ‚a poprawnie');
                    updateStatus('âœ… API Key jest aktywny', 'success');
                } else {
                    addDetail(`âš ï¸ Nieoczekiwany status: ${response.status}`);
                    updateStatus('âš ï¸ Nieoczekiwana odpowiedÅº z Firebase', 'warning');
                }

            } catch (error) {
                addDetail(`âŒ BÅ‚Ä…d HTTP request: ${error.message}`);
                updateStatus(`âŒ BÅ‚Ä…d poÅ‚Ä…czenia: ${error.message}`, 'error');
                console.error('HTTP test error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸŒ Test bezpoÅ›redni HTTP';
            }
        }
    </script>
</body>

</html>