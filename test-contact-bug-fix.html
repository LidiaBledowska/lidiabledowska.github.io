<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Contact Bug Fix</title>
    <style>
        body { margin: 20px; font-family: Arial, sans-serif; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .button { padding: 10px 20px; margin: 10px; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background: #005a8b; }
        .content-area { margin: 10px 0; padding: 20px; border: 2px solid #ddd; border-radius: 5px; min-height: 100px; }
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .status { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Test Contact Bug Fix</h1>
    
    <div class="test-section">
        <h2>Authentication State Simulation</h2>
        <p>This test simulates the authentication states and tests the contact modal behavior.</p>
        <button class="button" onclick="simulateLoggedOut()">Simulate Logged Out User</button>
        <button class="button" onclick="simulateLoggedIn()">Simulate Logged In User</button>
        <div id="authStatus" class="status">Status: Not set</div>
    </div>

    <div class="test-section">
        <h2>Test Contact Modal Behavior</h2>
        <button class="button" onclick="showContactModal()">Open Contact (Kontakt)</button>
        <button class="button" onclick="closeContactModal()">Close Contact (Return)</button>
    </div>

    <div class="test-section">
        <h2>Page Content Areas</h2>
        <div id="landingPage" class="content-area" style="background: #e8f4fd;">
            <h3>Landing Page</h3>
            <p>This should be visible for non-authenticated users.</p>
            <p>Contains: Welcome message, registration button, feature descriptions</p>
        </div>
        
        <div id="mainContent" class="content-area hidden" style="background: #f0f8e8;">
            <h3>Main Application Content</h3>
            <p>This should be visible for authenticated users.</p>
            <p>Contains: "Twoje aplikacje" table, application management features</p>
        </div>

        <div id="contactPage" class="content-area hidden" style="background: #fff4e6;">
            <h3>Contact Page</h3>
            <p>This is the contact modal/page.</p>
            <p>Contains: Contact form, return button</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="testResults"></div>
    </div>

    <script>
        // Mock Firebase auth
        window.auth = {
            currentUser: null
        };

        function simulateLoggedOut() {
            window.auth.currentUser = null;
            document.getElementById('authStatus').innerHTML = 'Status: <strong style="color: red;">Logged OUT</strong>';
            
            // Reset to initial state (landing page visible, main content hidden)
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('contactPage').style.display = 'none';
            
            updateTestResults('Simulated logged out user state');
        }

        function simulateLoggedIn() {
            window.auth.currentUser = { uid: 'test-user', email: 'test@example.com' };
            document.getElementById('authStatus').innerHTML = 'Status: <strong style="color: green;">Logged IN</strong>';
            
            // Set authenticated state (main content visible, landing page hidden)
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('contactPage').style.display = 'none';
            
            updateTestResults('Simulated logged in user state');
        }

        function showContactModal() {
            // This should hide both main application content and landing page
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('contactPage').style.display = 'flex';
            updateTestResults('Opened contact modal - all content hidden');
        }

        function closeContactModal() {
            // This is the fixed function - it should check authentication before deciding what to show
            document.getElementById('contactPage').style.display = 'none';

            const user = window.auth?.currentUser;
            if (user) {
                // User is authenticated - show main application content
                document.getElementById('mainContent').style.display = 'block';
                const landingPage = document.getElementById('landingPage');
                if (landingPage) {
                    landingPage.style.display = 'none';
                }
                updateTestResults('✅ FIXED: Returned authenticated user to main content', 'green');
            } else {
                // User is not authenticated - show landing page
                const landingPage = document.getElementById('landingPage');
                if (landingPage) {
                    landingPage.style.display = 'block';
                }
                const mainContent = document.getElementById('mainContent');
                if (mainContent) {
                    mainContent.style.display = 'none';
                }
                updateTestResults('✅ FIXED: Returned non-authenticated user to landing page', 'green');
            }
        }

        function updateTestResults(message, color = '#333') {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `<div style="margin: 5px 0; padding: 5px; background: #f9f9f9; border-left: 3px solid ${color};">${timestamp}: ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // Initialize test
        simulateLoggedOut();
        updateTestResults('Test environment initialized');
    </script>
</body>
</html>
